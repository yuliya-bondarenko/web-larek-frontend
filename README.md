# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемых в приложении

Интерфейс, описывающий поля товара в магазине

```
interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: CategoryTypes;
  price: number | null;
  selected: boolean;
}
```

Категории товара

```
type CategoryTypes =
  | 'другое'
  | 'софт-скил'
  | 'дополнительное'
  | 'кнопка'
  | 'хард-скил';

```

Интерфейс, описывающий внутренне состояние приложения

```
interface IAppFeelings {
  basket: ItemInShop[];
  store: ItemInShop[];
  order: IBasketOrder;
  formErrors: ErrorsForm;
  addItemToBasket(value: ItemInShop): void;
  deleteItemFromBasket(id: string): void;
  clearBasket(): void;
  amount(): number;
  getTotalPrice(): number;
  setItems(): void;
  setBasketOrderField(field: keyof IBasketOrderForm, value: string): void;
  validateContactForm(): boolean;
  validateOrderForm(): boolean;
  clearBasketOrder(): boolean;
  changingDataType(items: ICard[]): void;
  clearList(): void;
}
```
Тип, описывающий ошибки валидации форм

```
type ErrorsForm = Partial<Record<keyof IBasketOrderForm, string>>;

```
Интерфейс, описывающий поля заказа товара

```
interface IBasketOrder {
  items: string[];
  payment: string;
  total: number;
  address: string;
  email: string;
  phone: string;
}
```
Интерфейс, описывающий данные пользователя

```
interface IBasketOrderForm {
  payment: string;
  address: string;
  email: string;
  phone: string;
}
```

## Архитектура

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображения данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправи запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- 'get' - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- 'post' - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параментр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий  и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом 'IEvents':
- 'on' - подписка на событие
- 'emit' - инициализация события
- 'trigger' - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Абстрактный класс Component <T>
Предоставляет инструментарий для работы с DOM в дочерних компонентах.
Методы класса:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - Переключает класс элемента.
- setText(element: HTMLElement, value: unknown) - Устанавливает текстовое содержимое элемента.
- setDisabled(element: HTMLElement, state: boolean) - Устанавливает или убирает атрибут disabled для элемента.
- setVisible(element: HTMLElement) - Показывает элемент.
- setImage(element: HTMLImageElement, src: string, alt?: string) - Устанавливает изображение с альтернативным текстом для элемента <img>.
- render(data?: Partial<T>): HTMLElement - Возвращает корневой DOM-элемент компонента. Может принимать данные в виде объекта Partial<T>, которые будут применены к компоненту.

#### Абстрактный класс Model <T>
Представляет базовую модель данных событийного уведомления.
Методы:
- emitChanges(event: string, payload?: object) - Оповещает об изменениях в модели, отправляя событие event с переданным payload.

### Слой данных

#### Класс ApplicationState
Класс расширяет абстрактный класс Model<IAppFeelings> и представляет состояние приложения.\
Этот класс управляет состоянием приложения, обеспечивая функциональность добавления и удаления товаров из корзины, управления данными заказа и валидацию формы.\
В полях класса хранятся следующие данные:
- basket - Массив элементов корзины товаров.
- catalog - Массив элементов каталога товаров.
- order - Данные о заказе, включая email, телефон, адрес, способ оплаты и выбранные товары.
- formErrors - Объект с ошибками формы заказа.

 методы:
- addItemToBasket(value: ItemInShop): void - Метод для добавления товара в корзину
- deleteItemFromBasket(id: string): void - Метод для удаления товара из корзины
- clearBasket(): void - Метод для полной очистки корзины
- amount(): number - Метод для получения количества товаров в корзине
- getTotalPrice(): number - Метод для получения суммы цены всех товаров в корзине
- setItems(): void - Метод для добавления ID товаров в корзине в поле items для order
- setBasketOrderField(field: keyof IBasketOrderForm, value: string): void - Метод для заполнения полей email, phone, address, payment в order
- validateContactForm(): boolean - Валидация форм для окошка "контакты"
- validateOrderForm(): boolean - Валидация форм для окошка "заказ"
- clearBasketOrder(): boolean - Очистить order после покупки товаров
- changingDataType(items: ICard[]): void - Метод для превращения данных, полученых с сервера в тип данных приложения
- clearList(): void - Метод для обновления поля selected во всех товарах после совершения покупки

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс ModalWindow
Класс расширяет абстрактный класс Component<IModal>.Реализует модальное окно, путем подстановки в разметку готового контейнера со своей разметкой, содержимым  и объектом событий IEvents. Этот класс обеспечивает управление отображением модального окна на странице, позволяя открывать и закрывать его, а также устанавливать содержимое.
- constructor(container: HTMLElement, events: IEvents) - конструктор принимает контейнер, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса 'EventEmitter' для возможности инициализации событий.

Поля класса:
- _closeButton - HTML-элемент кнопки закрытия модального окна.
- _content - HTML-элемент содержимого модального окна.

методы:
- content(value: HTMLElement) - Устанавливает содержимое модального окна.
- open() - Открывает модальное окно и генерирует событие 'modal:open'.
- close() - Закрывает модальное окно, очищает содержимое и генерирует событие 'modal:close'.
- render(data: IModalData) - Рендерит модальное окно с указанными данными, открывая его при этом.

#### Класс BasketModal
Класс расширяет абстрактный класс Component<IBasketModal> и предназначен для показа содержимого корзины. Этот класс обеспечивает управление отображением корзины покупок на странице, обновляя список товаров, отображая общую сумму покупки и активируя кнопку оформления заказа.
Поля класса:
- _list: HTMLElement - список товаров в корзине.
- _price: HTMLElement - цена товаров.
- _button: HTMLButtonElement - кнопка покупки товара.
- _index: HTMLSpanElement[] - порядковый номер товара.

Методы:
- inactiveButton() - Метод отключающий кнопку "Оформить".
- renderIndexes(data?: Partial<IBasketModal>): HTMLElement - Метод для обновления индексов таблички при удалении товара из корзины.
Также класс содержит сеттеры для получения общей стоимости и списка выбранных товаров.

#### Класс BasketCard
Класс, описывает карточку в корзине.
Поля класса:
- _index: HTMLElement - порядковый номер карточки.
- _title: HTMLElement - название карточки.
- _price: HTMLElement - цена
- _button: HTMLButtonElement - кнопка удаления из списка в корзине.

Конструктор принимает имя блока, родительский элемент и обработчик событий. Содержит сеттеры для получения порядкового номера, названия и цены карточки.

#### Класс ModalForm
Расширяет абстрактный класс Component<IForm>.Предназначен для реализации модального окна с формой содержащей поля ввода, представляющий их общий функционал. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- submitButton: HTMLButtonElement - элемент кнопки отправки формы.
- formErrors - HTML-элемент для отображения сообщений об ошибках.

Методы:
- inputChanging(field: keyof T, value: string) - Обрабатывает изменение значения в полях формы и генерирует соответствующее событие.
- set valid(value: boolean) - Устанавливает состояние кнопки отправки формы (активна/неактивна).
- set errors(value: string) - Устанавливает сообщения об ошибках для отображения в форме.
- render(state: Partial<T> & IFormState) - Рендерит форму с указанным состоянием, обновляя значения полей и отображая ошибки.

#### Класс OrderUser
Дочерний класс от ModalForm. Нужен для установки данных пользователя при оформлении заказа: способ оплаты и адрес доставки. Создает новый экземпляр класса Order с указанным контейнером (HTML-элемент формы) и объектом событий IEvents, используя конструктор родительского класса ModalForm.
Поля класса:
- _card: HTMLButtonElement - кнопка для выбора оплаты картой.
- _cash: HTMLButtonElement - кнопка для выбора оплаты наличными.

Методы:
- falseButton() - отключает кнопки выбора оплаты.

#### Класс ContactsForm
Дочерний класс от ModalForm. Нужен для установки данных пользователя при оформлении заказа: электронная почта и телефон. Создает новый экземпляр класса с указанным контейнером (HTML-элемент формы) и объектом событий IEvents, используя конструктор родительского класса ModalForm.
Поля класса:
- _phoneInput: HTMLInputElement - телефон покупателя.
- _emailInput: HTMLInputElement - электронная почта покупателя.

Содержит сеттеры для получения номера телефона и почтового адреса покупателя.

#### Класс SuccessModal
Предназначен для реализации модального окна подтверждения успешной покупки.\
Поля класса:
- _button: HTMLButtonElement - элемент для закрытия сообщения об успешном завершении заказа.
- _price: HTMLElement - элемент, отображающий общее количество синапсов в заказе.

Присутствует сеттер для получения общей стоимости заказа.

#### Класс CardItem
Дочерний класс от Component<ICardItem>. Отвечает за отображение карточки, задавая в карточке данные названия, изображения, описания, цены, категории. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор принимает имя блока, родительский контейнер и объект с колбэк функциями.\
Содержит сеттеры и геттеры для получения данных карточки.

#### Класс View
Дочерний класс от Component<IView>. Класс представляет компонент страницы, который управляет различными элементами интерфейса, такими как счетчик корзины, каталог продуктов и блокировка страницы. Конструктор принимает родительский элемент и обработчик событий.\
Поля класса:
- _counter: HTMLElement - элемент для отображения счетчика корзины.
- _store: HTMLElement - элемент для отображения каталога продуктов.
- _wrapper: HTMLElement - элемент обертки страницы.
- _basket: HTMLElement - элемент корзины.

Содержит сеттеры для получения счетчика корзины, каталога продуктов и сеттер для блока прокрутки.

### Слой коммуникации

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

- `items:changed` - изменение массива карточек
- `card:select` - карточка выбрана
- `card:toBasket` - Инициируется при клике на кнопку "В корзину"
- `basket:open` - открытие модального окна корзины
- `basket:delete` - выбор карточки для удаления из корзины
- `basket:order` - Инициируется при клике на кнопку "Оформить" в корзине
- `order:submit` - Инициируется при нажатии на кнопку "Далее" на стадии заполнения адреса и способа оплаты
- `contacts:submit` - Инициируется при нажатии на кнопку "Оплатить" на стадии заполнения телефона и электронной почты
- `orderInput:change` - Инициируется при вводе данных в форму заказа и контактов. Начинает процесс валидации формы

- `orderErrors:change` - Инициируется при вводе данных в форму окошка с адресом доставки и совершает процесс валидации формы, возвращает ошибки формы
- `contactsErrors:change` - Инициируется при вводе данных в форму окошка контактов покупателя и совершает процесс валидации формы, возвращает ошибки формы
- `order:success` - Открывает модальное окно сообщающее об успешной оплате
- `modal:close` - Инициируется при клике на кнопку закрытия модального окна или при клике на свободное место вокруг модального окна